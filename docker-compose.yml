services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: chatbot_backend
    environment:
      - PORT=8000
      # Pass through Qdrant Cloud credentials from your local .env or set them here
      - QDRANT_URL=${QDRANT_URL}
      - QDRANT_API_KEY=${QDRANT_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
      - AZURE_OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION}
      - AZURE_OPENAI_EMBEDDING_DEPLOYMENT=${AZURE_OPENAI_EMBEDDING_DEPLOYMENT}
      # Ensure the backend knows where to store history
      - KB_PATH=data/knowledge_base
    volumes:
      # Persist chat history
      - ./data/chat_history:/app/data/chat_history
    ports:
      - "8000:8000"
