version: "3.9"

services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    restart: always
    ports:
      - "6333:6333"
    volumes:
      - qdrant_storage:/qdrant/storage
    environment:
      QDRANT__STORAGE__PATH: "/qdrant/storage"

  rag-backend:
    build: .
    container_name: rag_chatbot
    restart: always
    depends_on:
      - qdrant
    ports:
      - "8000:8000"
    env_file: .env
    environment:
      QDRANT_URL: "https://qdrant-app.politewave-6298a03c.eastus.azurecontainerapps.io"
      QDRANT_API_KEY: ""
      APP_ENV: "production"
    command: >
      bash -c "
      echo 'ğŸš€ Starting RAG Chatbot...' &&
      uvicorn src.chatbot_backend.rag_api:app --host 0.0.0.0 --port 8000 ||
      { echo 'âŒ Chatbot failed to start! Check your code.'; sleep 10; exit 1; }
      "

  frontend:
    build:
      context: frontend/ai-chatbot-ui
    container_name: rag_frontend
    restart: always
    ports:
      - "8080:80"
    depends_on:
      - rag-backend

volumes:
  qdrant_storage:
